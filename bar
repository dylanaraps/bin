#!/usr/bin/env bash
#
# bar - Dylan Araps
. ~/.cache/wal/colors.sh

vol() {
    cur="$(amixer get Master -n |
           awk -F '\\[|\\]' '/[0-9]{1,3}%/ {print $2" "$6}')"

    case "$cur" in
        [0-9]%*|*f*) vol_icon="\\uf026" ;;
        [1-4]?%*)    vol_icon="\\uf027" ;;
        [5-6]?%*|*)  vol_icon="\\uf028" ;;
    esac

    printf "%b" "$vol_icon ${cur/ *}"
}

wif() {
    cur="$(< /tmp/ssid)"
    printf "%b" "\\uf1eb ${cur/connect}"
}

tim() {
    printf "%(%a %d %b  - %l:%M %p)T"
}

bri() {
    cur="$(< /sys/class/backlight/intel_backlight/brightness)"
    printf "%b" "$((cur / 10 + 7))% \\uf0eb"
}

bat() {
    cur="$(< /sys/class/power_supply/BAT1/capacity)"
    sta="$(< /sys/class/power_supply/BAT1/status)"

    case "$cur" in
        [0-9])  bat_icon="\\uf244" ;;
        [1-3]?) bat_icon="\\uf243" ;;
        [4-5]?) bat_icon="\\uf242" ;;
        [6-7]?) bat_icon="\\uf241" ;;
        *)      bat_icon="\\uf240" ;;
    esac

    [[ "$sta" == Charging ]] && bat_icon+="  \\uf0e7"

    printf "%s%%  %b" "$cur" "$bat_icon"
}

for((;;)) {
    printf "    %s    \\n" "$(vol)   $(wif)%{c}$(tim)%{r}$(bri)   $(bat)"
    sleep 2
} |\

lemonbar -db \
         -g 1200x100+1000+75 \
         -f "Roboto Mono 22" \
         -f "FontAwesome-15" \
         -n "bar" \
         -B "#FFFFFF" \
         -F "${color0:-#000000}"
