#!/usr/bin/env bash
# shellcheck disable=SC1090
#
# bar - Dylan Araps
# unset PATH

source ~/.cache/wal/colors.sh

dat() {
    printf -v dat '%(%c)T' '-1'
    dat="${dat/ AEDT}"
    dat="${dat/:?? / }"
}

wif() {
    # Read wifi information from file populated by NetworkManager hook.
    cur="$(< /tmp/ssid)"
    wif="wifi: ${cur:-none}"
}

bri() {
    # Read brightness from file.
    cur="$(< /sys/class/backlight/intel_backlight/brightness)"
    bri="backlight: $((cur / 10 + 7))%"
}

bat() {
    # Read battery status from file.
    cur="$(< /sys/class/power_supply/BAT1/capacity)"
    sta="$(< /sys/class/power_supply/BAT1/status)"
    bat="battery: ${cur}% [${sta}]"
}

vol() {
    # Read volume information from file populated by volume hotkeys.
    cur="$(< ~/.cache/vol)"
    vol="volume: ${cur/ *}"
}

for ((;;)); {
    dat; bri; vol; wif; bat
    printf "%b\\n" " $dat %{r}$bri    $vol    $wif    $bat "
    sleep 0.2
} | lemonbar -B "${color0:-#000000}" \
             -F "${color15:-#FFFFFF}" \
             -f "Roboto Mono:size=15" \
             -g "x75"
