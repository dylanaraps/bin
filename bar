#!/usr/bin/env bash
# shellcheck disable=SC1090
#
# bar - Dylan Araps

enable -f /usr/lib/bash/sleep sleep

dat() {
    printf -v dat '%(%R)T'
}

wif() {
    cur="$(< /tmp/ssid)"
    wif="${cur:+ }"
}

bat() {
    cur="$(< /sys/class/power_supply/BAT1/capacity)"
    sta="$(< /sys/class/power_supply/BAT1/status)"

    case "$cur" in
        [0-9]|1[0-9])         bat="" ;;
        2[0-9]|3[0-9]|4[0-9]) bat="" ;;
        5[0-9]|6[0-9])        bat="" ;;
        7[0-9]|8[0-9])        bat="" ;;
        *)                    bat="" ;;
    esac

    [[ "$sta" == "Charging" ]] && bat+=" "
    bat+=" $((cur>99?100:cur))"
}

vol() {
    cur="$(< ~/.cache/vol)"

    case "${cur//%}" in
        [0-9]|1[0-9]|2[0-9]) vol="" ;;
        3[0-9]|4[0-9])       vol="" ;;
        *)                   vol="" ;;
    esac
}

pkill bar

for ((;;)) {
    dat; vol; bat
    printf '%b\n' "   $dat %{r}$vol  $bat   "
    sleep 1
} | lemonbar -B "$1" \
             -F "$2" \
             -f "Roboto Mono:size=16" \
             -f "Font Awesome:size=17" \
             -g "x100"
