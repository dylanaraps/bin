#!/usr/bin/env bash
#
# bar - Dylan Araps

enable -f /usr/lib/bash/sleep sleep

dat() {
    printf -v dat '%(%R)T'
}

bat() {
    read -r cur < /sys/class/power_supply/BAT1/capacity
    read -r sta < /sys/class/power_supply/BAT1/status

    ((cur<20)) &&         bat=
    ((cur<50&&cur>20)) && bat=
    ((cur>49&&cur<70)) && bat=
    ((cur<90&&cur>69)) && bat=
    ((cur>89)) &&         bat=

    [[ $sta == Charging ]] && bat+=' '
}

vol() {
    read -r cur < ~/.cache/vol

    ((cur>50)) && vol=
    ((cur<50)) && vol=
}

pkill bar

for ((;;)) {
    . ~/.cache/buddy/colors.sh
    dat; vol; bat
    echo "%{B#${clrs[0]}}" "%{F#${clrs[15]}}" " $dat %{r}$vol  $bat   "
    sleep 1
} | lemonbar -f "Roboto Mono:size=16" -f "Font Awesome:size=17" -g "x100"
